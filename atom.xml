<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>üëãBlog@Harry App</title>
  
  
  <link href="https://harry-studio.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://harry-studio.github.io/blog/"/>
  <updated>2026-01-12T03:33:21.938Z</updated>
  <id>https://harry-studio.github.io/blog/</id>
  
  <author>
    <name>Harry</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Third-party sync API (WealthTree)</title>
    <link href="https://harry-studio.github.io/blog/p/16167/"/>
    <id>https://harry-studio.github.io/blog/p/16167/</id>
    <published>2026-01-02T13:12:04.000Z</published>
    <updated>2026-01-12T03:33:21.938Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Third-party-sync-API-WealthTree"><a href="#Third-party-sync-API-WealthTree" class="headerlink" title="Third-party sync API (WealthTree)"></a>Third-party sync API (WealthTree)</h1><p>This document describes the HTTP requests the WealthTree iOS app sends to a user-provided third-party sync server, so anyone can implement a compatible endpoint.</p><p>Base URL: your server endpoint (example: <code>https://api.xscsd.cn/v1/cloudkit/index</code>).</p><h2 id="Auth"><a href="#Auth" class="headerlink" title="Auth"></a>Auth</h2><p>If the user enters an API Key in the app, it is sent as a header:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-API-Key: &#123;apiKey&#125;</span><br></pre></td></tr></table></figure><p>If left blank, the header is omitted.</p><p>The app also sends:</p><ul><li><code>Content-Type: application/json</code> (upload only)</li><li><code>Accept: application/json</code></li></ul><h2 id="Endpoint"><a href="#Endpoint" class="headerlink" title="Endpoint"></a>Endpoint</h2><p>WealthTree uses a single endpoint for upload and download.</p><p><code>POST &#123;base&#125;?sync_type=&#123;upload|download&#125;&amp;user_id=&#123;userId&#125;&amp;app_name=WealthTree</code></p><p>Notes:</p><ul><li><code>sync_type</code> is required.</li><li>For download, <code>user_id</code> and <code>app_name</code> must be present (query params).</li><li>For upload, the backend validates required fields from the JSON body (see below). Including <code>user_id/app_name</code> in the query is harmless.</li></ul><h2 id="Data-model"><a href="#Data-model" class="headerlink" title="Data model"></a>Data model</h2><p>The app uploads&#x2F;downloads a full snapshot object called <code>WealthData</code>.</p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p>Request:</p><p><code>POST &#123;base&#125;?sync_type=upload&amp;user_id=&#123;userId&#125;&amp;app_name=WealthTree</code></p><p>JSON body (required fields):</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WealthTree&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wealthtree-backup&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iOS backup from WealthTree&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#123;...json string...&#125;&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><code>data</code> can be either:</p><ul><li>a JSON object (WealthData), OR</li><li>a JSON string containing the WealthData JSON.</li></ul><p>The current iOS implementation sends <code>data</code> as a JSON string for compatibility.</p><p>Response (200):</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WealthTree&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wealthtree-backup&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updatetime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Note:</p><ul><li>Upload success response returns <strong>metadata only</strong> (it does not echo back the snapshot <code>data</code>).</li></ul><p>Error (400 example):</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p>Request:</p><p><code>POST &#123;base&#125;?sync_type=download&amp;user_id=&#123;userId&#125;&amp;app_name=WealthTree</code></p><p>Response (200):</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WealthTree&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wealthtree-backup&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">/* WealthData snapshot object */</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createtime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;updatetime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>The iOS app extracts the snapshot from <code>data.data</code>.</p><p>Compatibility note:</p><ul><li>Server may return <code>data.data</code> as a JSON object (current FastAPI behavior), or as a JSON string. The iOS app accepts both.</li></ul><h2 id="Errors"><a href="#Errors" class="headerlink" title="Errors"></a>Errors</h2><p>This FastAPI backend returns errors as:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Common cases:</p><ul><li>HTTP 400: <code>&#123; &quot;detail&quot;: &quot;sync_type ÂèÇÊï∞ÈîôËØØ&quot; &#125;</code></li><li>HTTP 400 (download): <code>&#123; &quot;detail&quot;: &quot;Áº∫Â∞ë user_id Êàñ app_name&quot; &#125;</code></li><li>HTTP 400 (upload): <code>&#123; &quot;detail&quot;: &quot;Áº∫Â∞ëÂøÖÂ°´Â≠óÊÆµ&quot; &#125;</code></li><li>HTTP 400 (upload): <code>&#123; &quot;detail&quot;: &quot;data ‰∏çËÉΩ‰∏∫Á©∫&quot; &#125;</code></li><li>HTTP 400 (upload): <code>&#123; &quot;detail&quot;: &quot;data ÈúÄ‰∏∫ÂêàÊ≥ï JSON Â≠óÁ¨¶‰∏≤ÊàñÂØπË±°&quot; &#125;</code></li><li>HTTP 404 (download): <code>&#123; &quot;detail&quot;: &quot;Êú™ÊâæÂà∞ËÆ∞ÂΩï&quot; &#125;</code></li></ul><h2 id="Quick-test-curl"><a href="#Quick-test-curl" class="headerlink" title="Quick test (curl)"></a>Quick test (curl)</h2><p>Upload:<br><code>curl -i -X POST &#39;&#123;base&#125;?sync_type=upload&amp;user_id=&#123;userId&#125;&amp;app_name=WealthTree&#39; -H &#39;Content-Type: application/json&#39; -H &#39;Accept: application/json&#39; -H &#39;X-API-Key: &#123;apiKey&#125;&#39; -d &#39;&#123;&quot;user_id&quot;:&quot;&#123;userId&#125;&quot;,&quot;app_name&quot;:&quot;WealthTree&quot;,&quot;name&quot;:&quot;wealthtree-backup&quot;,&quot;remark&quot;:&quot;iOS backup from WealthTree&quot;,&quot;data&quot;:&quot;&#123;&#125;&quot;&#125;&#39;</code></p><p>Download:<br><code>curl -i -X POST &#39;&#123;base&#125;?sync_type=download&amp;user_id=&#123;userId&#125;&amp;app_name=WealthTree&#39; -H &#39;Accept: application/json&#39; -H &#39;X-API-Key: &#123;apiKey&#125;&#39;</code></p>]]></content>
    
    
    <summary type="html">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Third-party sync API (Eve Period Tracker)</title>
    <link href="https://harry-studio.github.io/blog/p/27873/"/>
    <id>https://harry-studio.github.io/blog/p/27873/</id>
    <published>2026-01-01T13:12:04.000Z</published>
    <updated>2026-01-12T02:42:15.178Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Third-party-sync-API-Eve-Period-Tracker"><a href="#Third-party-sync-API-Eve-Period-Tracker" class="headerlink" title="Third-party sync API (Eve Period Tracker)"></a>Third-party sync API (Eve Period Tracker)</h1><h2 id="Base-URL-Configuration"><a href="#Base-URL-Configuration" class="headerlink" title="Base URL Configuration"></a>Base URL Configuration</h2><p>The app supports flexible base URL configurations:</p><ul><li><strong>Recommended</strong>: <code>https://api.example.com/v1/cloudkit</code> (full path)</li><li><strong>Also supported</strong>: <code>https://api.example.com</code> (the app auto-appends <code>/v1/cloudkit/&#123;action&#125;</code>)</li><li><strong>Legacy compatible</strong>: Paths with <code>/v1/Cloudkit/</code> or <code>/api/v1/cloudkit/</code></li></ul><p>The app automatically normalizes URLs and retries common path variants on HTTP 404.</p><h2 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h2><p>If the user enters an API Key in the app, it is sent as:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-API-Key: &#123;apiKey&#125;</span><br></pre></td></tr></table></figure><p>If left blank, no Authorization header is added.</p><h2 id="Upload-Endpoint"><a href="#Upload-Endpoint" class="headerlink" title="Upload Endpoint"></a>Upload Endpoint</h2><p><strong><code>POST &#123;base&#125;/save</code></strong></p><p>Example: <code>POST https://api.example.com/v1/cloudkit/save</code></p><p><strong>Request Body:</strong></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span>              <span class="comment">// required, user identifier</span></span><br><span class="line">  <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Eve Period&quot;</span><span class="punctuation">,</span>         <span class="comment">// fixed app name</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;period-backup&quot;</span><span class="punctuation">,</span>          <span class="comment">// fixed backup name</span></span><br><span class="line">  <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iOS backup from Eve Period&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sync_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;upload&quot;</span><span class="punctuation">,</span>            <span class="comment">// indicates upload intent</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>                         <span class="comment">// array of period entries</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UUID&quot;</span><span class="punctuation">,</span>                 <span class="comment">// unique entry ID</span></span><br><span class="line">      <span class="attr">&quot;startDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span>  <span class="comment">// ISO 8601 format</span></span><br><span class="line">      <span class="attr">&quot;note&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>                   <span class="comment">// optional note</span></span><br><span class="line">      <span class="attr">&quot;isPredicted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span>         <span class="comment">// prediction flag</span></span><br><span class="line">      <span class="attr">&quot;sequence&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>                <span class="comment">// entry sequence</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;come&quot;</span><span class="punctuation">,</span>               <span class="comment">// entry type</span></span><br><span class="line">      <span class="attr">&quot;cycleLength&quot;</span><span class="punctuation">:</span> <span class="number">28</span>             <span class="comment">// cycle length in days</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>Success Response (200):</strong></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>Error Response (4xx&#x2F;5xx):</strong></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Error description&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Or FastAPI style:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Error description&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Download-Endpoint"><a href="#Download-Endpoint" class="headerlink" title="Download Endpoint"></a>Download Endpoint</h2><p><strong><code>GET &#123;base&#125;/show</code></strong></p><p>Example: <code>GET https://api.example.com/v1/cloudkit/show?user_id=xxx&amp;app_name=Eve%20Period&amp;sync_type=download</code></p><p><strong>Query Parameters:</strong></p><ul><li><code>user_id</code> (required): User identifier</li><li><code>app_name</code> (required): <code>Eve Period</code></li><li><code>sync_type</code> (required): <code>download</code></li></ul><p><strong>Success Response (200):</strong></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;note&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;isPredicted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sequence&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;come&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cycleLength&quot;</span><span class="punctuation">:</span> <span class="number">28</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>The response <code>data</code> should be an array of entries matching the upload format. The app merges&#x2F;overwrites local data based on the selected sync mode.</p><h2 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h2><p>The app displays detailed error messages including:</p><ul><li>HTTP status code (e.g., <code>401</code>, <code>404</code>, <code>500</code>)</li><li>Request URL</li><li>Server error message from <code>message</code> or <code>detail</code> field</li></ul><p>Example error shown to user:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">API failed (HTTP 404) at https://api.example.com/v1/cloudkit/save: Not Found</span><br></pre></td></tr></table></figure><h2 id="Path-Auto-Correction"><a href="#Path-Auto-Correction" class="headerlink" title="Path Auto-Correction"></a>Path Auto-Correction</h2><p>On HTTP 404, the app automatically retries with common path variants:</p><ul><li>Case variations: <code>/v1/cloudkit/</code> ‚Üî <code>/v1/Cloudkit/</code></li><li>Prefix removal: <code>/api/v1/cloudkit/</code> ‚Üí <code>/v1/cloudkit/</code></li><li>Path reconstruction from configured base URL</li></ul><p>This ensures compatibility with various server configurations without manual adjustment.</p>]]></content>
    
    
    <summary type="html">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</summary>
    
    
    
    
  </entry>
  
</feed>
