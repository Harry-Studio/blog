<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>üëãBlog@Harry App</title>
  
  
  <link href="https://harry-studio.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://harry-studio.github.io/blog/"/>
  <updated>2025-12-24T14:52:40.993Z</updated>
  <id>https://harry-studio.github.io/blog/</id>
  
  <author>
    <name>Harry</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Third-party sync API (WealthTree)</title>
    <link href="https://harry-studio.github.io/blog/p/16167/"/>
    <id>https://harry-studio.github.io/blog/p/16167/</id>
    <published>2026-01-02T13:12:04.000Z</published>
    <updated>2025-12-24T14:52:40.993Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Third-party-sync-API-WealthTree"><a href="#Third-party-sync-API-WealthTree" class="headerlink" title="Third-party sync API (WealthTree)"></a>Third-party sync API (WealthTree)</h1><p>This document describes the exact HTTP requests the WealthTree iOS app sends to a user-provided ‚Äúthird‚Äëparty sync server‚Äù, so anyone can implement a compatible endpoint.</p><p>Base URL: your server endpoint (example: <code>https://example.com/api/wealthtree/sync</code>).</p><h2 id="Auth"><a href="#Auth" class="headerlink" title="Auth"></a>Auth</h2><p>If the user enters an API Key in the app, it is sent as:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-API-Key: &#123;apiKey&#125;</span><br></pre></td></tr></table></figure><p>If left blank, the header is omitted.</p><p>The app also sends:</p><ul><li><code>Content-Type: application/json</code></li><li><code>Accept: application/json</code></li></ul><p>Notes:</p><ul><li>The app does NOT send Basic Auth.</li><li>Request timeout is ~20 seconds.</li></ul><h2 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h2><p>The app uploads&#x2F;downloads a full <strong>snapshot</strong> object called <code>WealthData</code> (not a list of entries).</p><p>If you don‚Äôt want to reverse‚Äëengineer the full schema, the easiest implementation is:</p><ol><li>store the uploaded JSON blob as-is (per <code>user_id</code>),</li><li>return the same blob on download.</li></ol><p>The payload can be large.</p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p><code>POST &#123;base&#125;</code> (JSON)</p><p>The app uses the same Base URL for upload and download; it distinguishes intent by <code>sync_type</code>.</p><p>Request body:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span>                <span class="comment">// required; treat as opaque</span></span><br><span class="line">  <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WealthTree&quot;</span><span class="punctuation">,</span>            <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wealthtree-backup&quot;</span><span class="punctuation">,</span>         <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iOS backup from WealthTree&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sync_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;upload&quot;</span><span class="punctuation">,</span>              <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">/* WealthData snapshot */</span> <span class="punctuation">&#125;</span> <span class="comment">// required</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Response:</p><ul><li>HTTP status MUST be 2xx for success.</li><li>The app accepts either:<ul><li>no envelope <code>code</code> field, OR</li><li><code>code</code> equals <code>0</code> or <code>200</code>.</li></ul></li></ul><p>Recommended success response:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><code>POST &#123;base&#125;</code> (JSON)</p><p>Request body:</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span>     <span class="comment">// required</span></span><br><span class="line">  <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WealthTree&quot;</span><span class="punctuation">,</span> <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;sync_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;download&quot;</span>  <span class="comment">// fixed</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Response:</p><ul><li>HTTP status MUST be 2xx for success.</li><li>Response MUST be JSON.</li></ul><p>If you include an envelope <code>code</code> field, use <code>0</code> or <code>200</code> for success; any other value will be treated as an error.</p><p>Recommended response shape (simplest):</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ok&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">/* WealthData snapshot */</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Also supported by the app (for compatibility with different servers):</p><ul><li><code>data</code> can be a JSON string containing the WealthData JSON.</li><li><code>data</code> can be an array where the first element is a WealthData.</li><li><code>data</code> can be an object that contains a nested <code>data</code> field holding WealthData (i.e. <code>data.data</code>).</li></ul><p>The app also accepts <strong>non-enveloped</strong> responses:</p><ul><li>the raw WealthData JSON object</li><li>a raw JSON string containing WealthData</li><li>a raw array of objects like <code>[&#123; &quot;data&quot;: &#123; /* WealthData */ &#125; &#125;]</code></li></ul><p>Overwrite behavior:</p><ul><li>‚ÄúDownload from third-party (overwrite local)‚Äù replaces local data with the downloaded snapshot.</li><li>‚ÄúUpload to third-party (overwrite remote)‚Äù uploads the full local snapshot.</li></ul><p>Empty-snapshot protection:</p><ul><li>The app may reject a download if it <em>looks like an empty snapshot</em> (all major arrays empty AND all timestamps are 0), to avoid overwriting local data with a bad server response.</li><li>If your server legitimately stores an ‚Äúempty account‚Äù, include meaningful timestamps or return the last known snapshot.</li></ul><h2 id="Minimal-reference-implementation"><a href="#Minimal-reference-implementation" class="headerlink" title="Minimal reference implementation"></a>Minimal reference implementation</h2><p>The simplest compatible server stores the <strong>latest uploaded snapshot JSON</strong> per <code>user_id</code>, then returns it on download.</p><p>Behavior:</p><ul><li>On <code>sync_type=upload</code>: save the request body‚Äôs <code>data</code> as the latest snapshot for <code>user_id</code>.</li><li>On <code>sync_type=download</code>: return the latest saved snapshot for <code>user_id</code>.</li></ul><p>Important:</p><ul><li>Do not ‚Äúnormalize‚Äù or partially parse the <code>data</code> payload unless you fully understand the <code>WealthData</code> schema.</li><li>If no snapshot exists yet, prefer returning an error (non-2xx, or an envelope with non-success <code>code</code>) rather than an empty snapshot.</li></ul><p>Example (Node.js + Express, in-memory store):</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&quot;express&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>(&#123; <span class="attr">limit</span>: <span class="string">&quot;20mb&quot;</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// In production, replace with a DB table keyed by (user_id).</span></span><br><span class="line"><span class="keyword">const</span> latestByUser = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/wealthtree/sync&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; user_id, sync_type, data &#125; = req.<span class="property">body</span> || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!user_id || !sync_type) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">400</span>, <span class="attr">message</span>: <span class="string">&quot;missing user_id or sync_type&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sync_type === <span class="string">&quot;upload&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">400</span>, <span class="attr">message</span>: <span class="string">&quot;missing data&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    latestByUser.<span class="title function_">set</span>(<span class="title class_">String</span>(user_id), data);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&quot;ok&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sync_type === <span class="string">&quot;download&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> snapshot = latestByUser.<span class="title function_">get</span>(<span class="title class_">String</span>(user_id));</span><br><span class="line">    <span class="keyword">if</span> (!snapshot) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">404</span>, <span class="attr">message</span>: <span class="string">&quot;no snapshot for user&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">&quot;ok&quot;</span>, <span class="attr">data</span>: snapshot &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">code</span>: <span class="number">400</span>, <span class="attr">message</span>: <span class="string">&quot;invalid sync_type&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Third-party sync API (Esay Period)</title>
    <link href="https://harry-studio.github.io/blog/p/27873/"/>
    <id>https://harry-studio.github.io/blog/p/27873/</id>
    <published>2026-01-01T13:12:04.000Z</published>
    <updated>2025-12-16T04:32:39.541Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Third-party-sync-API-Esay-Period"><a href="#Third-party-sync-API-Esay-Period" class="headerlink" title="Third-party sync API (Esay Period)"></a>Third-party sync API (Esay Period)</h1><p>Base URL: your server endpoint (e.g. <code>https://example.com/api/xxx</code>).</p><h2 id="Auth"><a href="#Auth" class="headerlink" title="Auth"></a>Auth</h2><p>If the user enters an API Key in the app, it is sent as:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">X-API-Key: &#123;apiKey&#125;</span><br></pre></td></tr></table></figure><p>If left blank, no Authorization header is added.</p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><p><code>POST &#123;base&#125;</code></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span>              <span class="comment">// required</span></span><br><span class="line">  <span class="attr">&quot;app_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;EsayPeriod&quot;</span><span class="punctuation">,</span>         <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;period-backup&quot;</span><span class="punctuation">,</span>          <span class="comment">// fixed</span></span><br><span class="line">  <span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span> <span class="string">&quot;iOS backup from Esay Period&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sync_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;upload&quot;</span><span class="punctuation">,</span>            <span class="comment">// indicates upload intent</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>                         <span class="comment">// array of entries</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UUID&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;startDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-01-01T00:00:00Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;note&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;isPredicted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sequence&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;come&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cycleLength&quot;</span><span class="punctuation">:</span> <span class="number">28</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Returns: JSON with <code>code</code>, <code>message</code>, and optional <code>data</code> from server.</p><h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><code>GET &#123;base&#125;/?user_id=xxx&amp;app_name=EsayPeriod&amp;sync_type=download</code></p><p>Response <code>data</code> should be an array of entries in the same shape as upload <code>data</code> (fields listed above). The app merges&#x2F;overwrites based on the selected mode. Optional Basic Auth headers are sent when username&#x2F;password are provided in the UI.</p>]]></content>
    
    
    <summary type="html">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</summary>
    
    
    
    
  </entry>
  
</feed>
